<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PHTV.Windows.ViewModels"
             x:Class="PHTV.Windows.Views.Tabs.HotkeysTabView"
             x:DataType="vm:HotkeysTabViewModel">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Margin="32,54,32,32" Spacing="20" MaxWidth="760">
      <Border Classes="settings-header">
        <Grid ColumnDefinitions="*,Auto">
          <StackPanel Spacing="4">
            <TextBlock Classes="settings-header-title" Text="{Binding Title}"/>
            <TextBlock Classes="settings-header-subtitle" Text="{Binding Subtitle}" TextWrapping="Wrap"/>
          </StackPanel>
          <Border Grid.Column="1" Classes="status-pill" VerticalAlignment="Center" Margin="16,0,0,0">
            <TextBlock Classes="status-pill-text" Text="{Binding State.SwitchHotkeyDisplay, StringFormat='Chuyển chế độ: {0}'}"/>
          </Border>
        </Grid>
      </Border>

      <!-- Chuyển chế độ gõ -->
      <Border Classes="settings-card">
        <StackPanel>
          <Border Classes="settings-card-header indigo">
            <Grid ColumnDefinitions="40,*">
              <Border Classes="settings-card-icon"><TextBlock Classes="settings-card-icon-text" Text=""/></Border>
              <StackPanel Grid.Column="1" Spacing="2">
                <TextBlock Classes="settings-card-title" Text="Chuyển chế độ gõ"/>
                <TextBlock Classes="settings-card-subtitle" Text="Thiết lập phím tắt nhanh theo kiểu Windows"/>
              </StackPanel>
            </Grid>
          </Border>

          <StackPanel Margin="16" Spacing="16">
            <StackPanel Spacing="8">
              <TextBlock Classes="settings-row-title" Text="Phím bổ trợ"/>
              <UniformGrid Columns="5">
                <ToggleButton Classes="hotkey-selector-button" Margin="0,0,4,0" IsChecked="{Binding State.SwitchHotkeyControl}">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Classes="symbol" Text="Ctrl"/>
                    <TextBlock Classes="label" Text="Control"/>
                  </StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.SwitchHotkeyOption}">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Classes="symbol" Text="Alt"/>
                    <TextBlock Classes="label" Text="Alt"/>
                  </StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.SwitchHotkeyCommand}">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Classes="symbol" Text=""/>
                    <TextBlock Classes="label" Text="Win"/>
                  </StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.SwitchHotkeyShift}">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Classes="symbol" Text="⇧"/>
                    <TextBlock Classes="label" Text="Shift"/>
                  </StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="4,0,0,0" IsChecked="{Binding State.SwitchHotkeyFn}">
                  <StackPanel HorizontalAlignment="Center">
                    <TextBlock Classes="symbol" Text="fn"/>
                    <TextBlock Classes="label" Text="Fn"/>
                  </StackPanel>
                </ToggleButton>
              </UniformGrid>
              <TextBlock Classes="hotkey-hint" Text="Mặc định: Ctrl + Shift. Nhấn phím để bật/tắt modifier."/>
            </StackPanel>

            <Border Classes="settings-divider"/>

            <Grid ColumnDefinitions="*,220" VerticalAlignment="Center">
              <StackPanel Spacing="2">
                <TextBlock Classes="settings-row-title" Text="Phím chính (tùy chọn)"/>
                <TextBlock Classes="settings-row-subtitle" Text="Có thể để 'Không' để dùng chế độ chỉ modifier"/>
              </StackPanel>
              <ComboBox Grid.Column="1"
                        Classes="hotkey-primary-selector"
                        ItemsSource="{Binding State.SwitchHotkeyPrimaryOptions}"
                        SelectedItem="{Binding State.SwitchHotkeyPrimary}"/>
            </Grid>

            <Border Classes="hotkey-preview">
              <StackPanel Spacing="2">
                <TextBlock Classes="hotkey-preview-label" Text="Tổ hợp hiện tại"/>
                <TextBlock Classes="hotkey-preview-value" Text="{Binding State.SwitchHotkeyDisplay}"/>
              </StackPanel>
            </Border>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- Khôi phục ký tự -->
      <Border Classes="settings-card">
        <StackPanel>
          <Border Classes="settings-card-header indigo">
            <Grid ColumnDefinitions="40,*">
              <Border Classes="settings-card-icon"><TextBlock Classes="settings-card-icon-text" Text="↶"/></Border>
              <StackPanel Grid.Column="1" Spacing="2">
                <TextBlock Classes="settings-card-title" Text="Khôi phục ký tự"/>
                <TextBlock Classes="settings-card-subtitle" Text="Hoàn tác nhanh khi gõ sai"/>
              </StackPanel>
            </Grid>
          </Border>

          <StackPanel Margin="16" Spacing="16">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Spacing="2">
                <TextBlock Classes="settings-row-title" Text="Hoàn tác về ký tự gốc"/>
                <TextBlock Classes="settings-row-subtitle" Text="Dùng phím hoàn tác để trả về ký tự trước khi biến đổi"/>
              </StackPanel>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding State.RestoreOnEscape}"/>
            </Grid>
            
            <StackPanel Spacing="8" IsVisible="{Binding State.RestoreOnEscape}">
              <TextBlock Classes="settings-row-title" Text="Chọn phím hoàn tác"/>
              <UniformGrid Columns="3">
                <ToggleButton Classes="hotkey-selector-button" Margin="0,0,6,0" IsChecked="{Binding State.RestoreKeyEscSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="⎋"/><TextBlock Classes="label" Text="ESC"/></StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="6,0,6,0" IsChecked="{Binding State.RestoreKeyOptionSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Alt"/><TextBlock Classes="label" Text="Alt"/></StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="6,0,0,0" IsChecked="{Binding State.RestoreKeyControlSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Ctrl"/><TextBlock Classes="label" Text="Ctrl"/></StackPanel>
                </ToggleButton>
              </UniformGrid>
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- Tạm dừng gõ -->
      <Border Classes="settings-card">
        <StackPanel>
          <Border Classes="settings-card-header indigo">
            <Grid ColumnDefinitions="40,*">
              <Border Classes="settings-card-icon"><TextBlock Classes="settings-card-icon-text" Text="⏸"/></Border>
              <StackPanel Grid.Column="1" Spacing="2">
                <TextBlock Classes="settings-card-title" Text="Tạm dừng gõ tiếng Việt"/>
                <TextBlock Classes="settings-card-subtitle" Text="Tạm ngưng bộ gõ khi cần nhập liệu đặc biệt"/>
              </StackPanel>
            </Grid>
          </Border>

          <StackPanel Margin="16" Spacing="16">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Spacing="2">
                <TextBlock Classes="settings-row-title" Text="Bật phím tạm dừng"/>
                <TextBlock Classes="settings-row-subtitle" Text="Giữ phím để tạm chuyển sang English"/>
              </StackPanel>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding State.PauseKeyEnabled}"/>
            </Grid>
            
            <StackPanel Spacing="8" IsVisible="{Binding State.PauseKeyEnabled}">
              <TextBlock Classes="settings-row-title" Text="Phím tạm dừng"/>
              <UniformGrid Columns="3">
                <ToggleButton Classes="hotkey-selector-button" Margin="0,0,6,0" IsChecked="{Binding State.PauseKeyAltSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Alt"/><TextBlock Classes="label" Text="Alt"/></StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="6,0,6,0" IsChecked="{Binding State.PauseKeyControlSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Ctrl"/><TextBlock Classes="label" Text="Ctrl"/></StackPanel>
                </ToggleButton>
                <ToggleButton Classes="hotkey-selector-button" Margin="6,0,0,0" IsChecked="{Binding State.PauseKeyShiftSelected}">
                  <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="⇧"/><TextBlock Classes="label" Text="Shift"/></StackPanel>
                </ToggleButton>
              </UniformGrid>
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </Border>

      <!-- PHTV Picker -->
      <Border Classes="settings-card">
        <StackPanel>
          <Border Classes="settings-card-header indigo">
            <Grid ColumnDefinitions="40,*">
              <Border Classes="settings-card-icon"><TextBlock Classes="settings-card-icon-text" Text="☺"/></Border>
              <StackPanel Grid.Column="1" Spacing="2">
                <TextBlock Classes="settings-card-title" Text="PHTV Picker"/>
                <TextBlock Classes="settings-card-subtitle" Text="Mở nhanh bảng emoji/sticker/GIF"/>
              </StackPanel>
            </Grid>
          </Border>

          <StackPanel Margin="16" Spacing="16">
            <Grid ColumnDefinitions="*,Auto">
              <StackPanel Spacing="2">
                <TextBlock Classes="settings-row-title" Text="Bật hotkey PHTV Picker"/>
                <TextBlock Classes="settings-row-subtitle" Text="Mở nhanh picker trong mọi ứng dụng"/>
              </StackPanel>
              <ToggleSwitch Grid.Column="1" IsChecked="{Binding State.EmojiHotkeyEnabled}"/>
            </Grid>

            <StackPanel IsVisible="{Binding State.EmojiHotkeyEnabled}" Spacing="16">
              <Border Classes="settings-divider"/>

              <StackPanel Spacing="8">
                <TextBlock Classes="settings-row-title" Text="Phím bổ trợ"/>
                <UniformGrid Columns="5">
                  <ToggleButton Classes="hotkey-selector-button" Margin="0,0,4,0" IsChecked="{Binding State.EmojiHotkeyControl}">
                    <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Ctrl"/><TextBlock Classes="label" Text="Ctrl"/></StackPanel>
                  </ToggleButton>
                  <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.EmojiHotkeyOption}">
                    <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="Alt"/><TextBlock Classes="label" Text="Alt"/></StackPanel>
                  </ToggleButton>
                  <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.EmojiHotkeyCommand}">
                    <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text=""/><TextBlock Classes="label" Text="Win"/></StackPanel>
                  </ToggleButton>
                  <ToggleButton Classes="hotkey-selector-button" Margin="4,0,4,0" IsChecked="{Binding State.EmojiHotkeyShift}">
                    <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="⇧"/><TextBlock Classes="label" Text="Shift"/></StackPanel>
                  </ToggleButton>
                  <ToggleButton Classes="hotkey-selector-button" Margin="4,0,0,0" IsChecked="{Binding State.EmojiHotkeyFn}">
                    <StackPanel HorizontalAlignment="Center"><TextBlock Classes="symbol" Text="fn"/><TextBlock Classes="label" Text="Fn"/></StackPanel>
                  </ToggleButton>
                </UniformGrid>
              </StackPanel>

              <Grid ColumnDefinitions="*,220" VerticalAlignment="Center">
                <StackPanel Spacing="2">
                  <TextBlock Classes="settings-row-title" Text="Phím chính"/>
                  <TextBlock Classes="settings-row-subtitle" Text="Mặc định: E"/>
                </StackPanel>
                <ComboBox Grid.Column="1"
                          Classes="hotkey-primary-selector"
                          ItemsSource="{Binding State.EmojiHotkeyPrimaryOptions}"
                          SelectedItem="{Binding State.EmojiHotkeyPrimary}"/>
              </Grid>

              <Border Classes="hotkey-preview">
                <StackPanel Spacing="2">
                  <TextBlock Classes="hotkey-preview-label" Text="Tổ hợp hiện tại"/>
                  <TextBlock Classes="hotkey-preview-value" Text="{Binding State.EmojiHotkeyDisplay}"/>
                </StackPanel>
              </Border>
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </Border>
    </StackPanel>
  </ScrollViewer>
</UserControl>
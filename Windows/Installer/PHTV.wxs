<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?ifndef ProductVersion ?>
        <?define ProductVersion = "1.0.0" ?>
    <?endif?>
    <?define Manufacturer = "Pham Hung Tien" ?>
    <?define ProductName = "PHTV" ?>
    <?define UpgradeCode = "7E3F1B2C-D4A5-4E6F-8A9B-0C1D2E3F4A5B" ?>

    <Product Id="*" 
             Name="$(var.ProductName)" 
             Language="1033" 
             Codepage="1258"
             Version="$(var.ProductVersion)" 
             Manufacturer="$(var.Manufacturer)" 
             UpgradeCode="$(var.UpgradeCode)">
        
        <Package InstallerVersion="200"
                 Compressed="yes"
                 InstallScope="perMachine"
                 SummaryCodepage="1258" />

        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <MediaTemplate EmbedCab="yes" />

        <!-- Icon cho Add/Remove Programs -->
        <Icon Id="AppIcon" SourceFile="Assets\icon.ico" />
        <Property Id="ARPPRODUCTICON" Value="AppIcon" />
        <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch PHTV after setup" />

        <!-- Cấu trúc thư mục -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="INSTALLFOLDER" Name="$(var.ProductName)">
                    <Directory Id="DictionariesFolder" Name="Dictionaries" />
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName)"/>
            </Directory>
            <Directory Id="DesktopFolder" Name="Desktop" />
        </Directory>

        <!-- Thành phần file -->
        <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
            <Component Id="MainExecutable" Guid="*">
                <File Id="PHTVEXE" Source="Source\PHTV.exe" KeyPath="yes" Checksum="yes">
                    <Shortcut Id="StartMenuShortcut" 
                              Directory="ApplicationProgramsFolder" 
                              Name="$(var.ProductName)" 
                              WorkingDirectory="INSTALLFOLDER" 
                              Icon="AppIcon" 
                              Advertise="yes" />
                    <Shortcut Id="DesktopShortcut" 
                              Directory="DesktopFolder" 
                              Name="$(var.ProductName)" 
                              WorkingDirectory="INSTALLFOLDER" 
                              Icon="AppIcon" 
                              Advertise="yes" />
                </File>
                <RemoveFolder Id="CleanupShortcut" Directory="ApplicationProgramsFolder" On="uninstall" />
            </Component>
        </ComponentGroup>

        <ComponentGroup Id="DictionaryComponents" Directory="DictionariesFolder">
            <Component Id="EnDict" Guid="*">
                <File Id="en_dict.bin" Source="Source\Dictionaries\en_dict.bin" KeyPath="yes" />
            </Component>
            <Component Id="ViDict" Guid="*">
                <File Id="vi_dict.bin" Source="Source\Dictionaries\vi_dict.bin" KeyPath="yes" />
            </Component>
        </ComponentGroup>

        <!-- Giao diện cài đặt -->
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
        <UIRef Id="WixUI_InstallDir" />
        
        <!-- Khởi chạy ứng dụng sau khi cài -->
        <Property Id="WixShellExecTarget" Value="[#PHTVEXE]" />
        <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />

        <Feature Id="ProductFeature" Title="PHTV" Level="1">
            <ComponentGroupRef Id="ProductComponents" />
            <ComponentGroupRef Id="DictionaryComponents" />
        </Feature>
    </Product>
</Wix>
